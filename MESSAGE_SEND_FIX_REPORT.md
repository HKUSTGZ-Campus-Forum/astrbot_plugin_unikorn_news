# AstrBotæ’ä»¶æ¶ˆæ¯å‘é€é—®é¢˜åˆ†æä¸ä¿®å¤æŠ¥å‘Š

## é—®é¢˜æ€»ç»“

é€šè¿‡å¯¹ç…§AstrBotå®˜æ–¹æ–‡æ¡£ (https://docs.astrbot.app/dev/star/plugin.html)ï¼Œå‘ç°äº†æ’ä»¶ä¸­æ¶ˆæ¯å‘é€éƒ¨åˆ†çš„é—®é¢˜å¹¶è¿›è¡Œäº†ä¿®å¤ã€‚

## ğŸ” å‘ç°çš„ä¸»è¦é—®é¢˜

### 1. æ¶ˆæ¯å‘é€APIä½¿ç”¨ä¸æ­£ç¡®

**é—®é¢˜æè¿°ï¼š**
- åŸä»£ç ä½¿ç”¨äº†é”™è¯¯çš„æ¶ˆæ¯å‘é€æ–¹å¼
- ç›´æ¥ä¼ é€’æ¶ˆæ¯ç»„ä»¶åˆ—è¡¨è€Œä¸æ˜¯ä½¿ç”¨MessageChain

**åŸä»£ç ï¼š**
```python
chain = [Comp.Plain(message)]
await self.context.send_message(unified_msg_origin, chain)
```

**ä¿®å¤åï¼š**
```python
from astrbot.api.event import MessageChain

message_chain = MessageChain().message(message)
await self.context.send_message(unified_msg_origin, message_chain)
```

### 2. ç¼ºå°‘å¿…è¦çš„å¯¼å…¥

**é—®é¢˜æè¿°ï¼š**
- æ²¡æœ‰å¯¼å…¥ `MessageChain` ç±»

**ä¿®å¤ï¼š**
```python
# ä¿®æ”¹å‰
from astrbot.api.event import filter, AstrMessageEvent, MessageEventResult

# ä¿®æ”¹å  
from astrbot.api.event import filter, AstrMessageEvent, MessageEventResult, MessageChain
```

## âœ… ä¿®å¤è¯´æ˜

### 1. æ­£ç¡®çš„ä¸»åŠ¨æ¶ˆæ¯å‘é€æ–¹å¼

æ ¹æ®AstrBotå®˜æ–¹æ–‡æ¡£ï¼Œä¸»åŠ¨å‘é€æ¶ˆæ¯åº”è¯¥ï¼š

1. **ä½¿ç”¨ MessageChain æ„é€ æ¶ˆæ¯ï¼š**
   ```python
   message_chain = MessageChain().message("æ–‡æœ¬å†…å®¹")
   ```

2. **ä½¿ç”¨ context.send_message å‘é€ï¼š**
   ```python
   await self.context.send_message(unified_msg_origin, message_chain)
   ```

3. **unified_msg_origin æ ¼å¼æ­£ç¡®ï¼š**
   ```python
   unified_msg_origin = f"qq_group_{group_id}"
   ```

### 2. ä¿®å¤éªŒè¯

é€šè¿‡æµ‹è¯•è„šæœ¬éªŒè¯ä¿®å¤æ•ˆæœï¼š
- âœ… æ¶ˆæ¯é“¾æ„é€ æ­£ç¡®
- âœ… æ¶ˆæ¯å‘é€æ ¼å¼ç¬¦åˆAstrBotè§„èŒƒ
- âœ… ç¾¤å·æ ¼å¼æ­£ç¡®
- âœ… é”™è¯¯å¤„ç†å®Œå–„

## ğŸ“‹ å…¶ä»–ä»£ç è´¨é‡æ£€æŸ¥

### âœ… ç¬¦åˆè§„èŒƒçš„åœ°æ–¹ï¼š

1. **æ’ä»¶ç»“æ„æ­£ç¡®ï¼š**
   - ç»§æ‰¿è‡ª Star åŸºç±»
   - ä½¿ç”¨ @register è£…é¥°å™¨æ³¨å†Œæ’ä»¶
   - å®ç°äº† initialize() å’Œ terminate() æ–¹æ³•

2. **é…ç½®ç®¡ç†æ­£ç¡®ï¼š**
   - æœ‰ _conf_schema.json é…ç½®æ–‡ä»¶
   - æ­£ç¡®ä½¿ç”¨ self.config è·å–é…ç½®

3. **é”™è¯¯å¤„ç†å®Œå–„ï¼š**
   - ä½¿ç”¨äº†é€‚å½“çš„ try-except å—
   - è®°å½•äº†è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

4. **å¼‚æ­¥å¤„ç†æ­£ç¡®ï¼š**
   - ä½¿ç”¨äº† asyncio è¿›è¡Œå¼‚æ­¥ä»»åŠ¡ç®¡ç†
   - HTTPè¯·æ±‚ä½¿ç”¨äº† aiohttp

5. **æ•°æ®æŒä¹…åŒ–åˆç†ï¼š**
   - å°†æ•°æ®å­˜å‚¨åœ¨ data ç›®å½•ï¼Œé¿å…æ’ä»¶æ›´æ–°æ—¶ä¸¢å¤±

## ğŸš€ æµ‹è¯•å»ºè®®

### 1. åŸºæœ¬åŠŸèƒ½æµ‹è¯•ï¼š
```bash
# åœ¨AstrBotä¸­æµ‹è¯•æŒ‡ä»¤
/unikorn status      # æŸ¥çœ‹çŠ¶æ€
/unikorn check       # æ‰‹åŠ¨æ£€æŸ¥
/unikorn posts       # æŸ¥çœ‹æœ€æ–°å¸–å­
```

### 2. æ¶ˆæ¯æ¨é€æµ‹è¯•ï¼š
1. é…ç½®ç›®æ ‡ç¾¤å·
2. å¯åŠ¨ç›‘æ§ï¼š`/unikorn start`
3. ç­‰å¾…æˆ–æ‰‹åŠ¨è§¦å‘æ£€æŸ¥
4. éªŒè¯ç¾¤æ¶ˆæ¯æ¨é€

### 3. é…ç½®æµ‹è¯•ï¼š
1. åœ¨AstrBotç®¡ç†é¢æ¿ä¸­é…ç½®æ’ä»¶
2. ä¿®æ”¹æ£€æŸ¥é—´éš”ã€ç›®æ ‡ç¾¤ç­‰å‚æ•°
3. éªŒè¯é…ç½®ç”Ÿæ•ˆ

## ğŸ“š ç›¸å…³æ–‡æ¡£å‚è€ƒ

- [AstrBotæ’ä»¶å¼€å‘æ–‡æ¡£](https://docs.astrbot.app/dev/star/plugin.html)
- [å‘é€æ¶ˆæ¯éƒ¨åˆ†](https://docs.astrbot.app/dev/star/plugin.html#å‘é€æ¶ˆæ¯)
- [MessageChainä½¿ç”¨](https://docs.astrbot.app/dev/star/plugin.html#å‘é€å›¾æ–‡ç­‰å¯Œåª’ä½“æ¶ˆæ¯)

## ğŸ¯ åç»­ä¼˜åŒ–å»ºè®®

1. **æ·»åŠ æ¶ˆæ¯æ ¼å¼é…ç½®ï¼š**
   - å…è®¸ç”¨æˆ·è‡ªå®šä¹‰æ¨é€æ¶ˆæ¯çš„æ ¼å¼

2. **å¢åŠ è¿‡æ»¤åŠŸèƒ½ï¼š**
   - æ”¯æŒæŒ‰å…³é”®è¯è¿‡æ»¤å¸–å­
   - æ”¯æŒæŒ‰ç‰ˆå—è¿‡æ»¤

3. **æ”¹è¿›é”™è¯¯å¤„ç†ï¼š**
   - åœ¨ç½‘ç»œé”™è¯¯æ—¶å®ç°é‡è¯•æœºåˆ¶
   - æ·»åŠ æ›´è¯¦ç»†çš„é”™è¯¯æŠ¥å‘Š

4. **æ€§èƒ½ä¼˜åŒ–ï¼š**
   - ç¼“å­˜ç½‘é¡µå†…å®¹é¿å…é‡å¤è¯·æ±‚
   - ä¼˜åŒ–å¸–å­è§£æé€»è¾‘

## ç»“è®º

âœ… **æ¶ˆæ¯å‘é€é—®é¢˜å·²ä¿®å¤**
- ä½¿ç”¨äº†æ­£ç¡®çš„ MessageChain API
- ç¬¦åˆAstrBotå®˜æ–¹è§„èŒƒ
- é€šè¿‡æµ‹è¯•éªŒè¯æœ‰æ•ˆ

æ’ä»¶ç°åœ¨åº”è¯¥èƒ½å¤Ÿæ­£ç¡®å‘é€æ¶ˆæ¯åˆ°é…ç½®çš„QQç¾¤äº†ã€‚å»ºè®®åœ¨å®é™…ç¯å¢ƒä¸­æµ‹è¯•éªŒè¯åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚
